# テスト戦略

このプロジェクトでは、コードの品質とアプリケーションの安定性を確保するために、2段階のテスト戦略を採用しています。

- **ユニットテスト/結合テスト:** [Vitest](https://vitest.dev/) を使用して、個別のモジュールとその相互作用をテストします。これにより、ブラウザを必要とせずに、ゲームのコアロジックを高速かつ集中的にテストできます。
- **エンドツーエンド（E2E）テスト:** [Playwright](https://playwright.dev/) を使用して、実際のブラウザでのユーザー操作をシミュレートします。これにより、UIから基盤となるロジックまで、アプリケーション全体が正しく機能していることを保証します。

すべてのテストコマンドは `ts-port/` ディレクトリから実行する必要があります。

## ユニットテストの実行

ユニットテストは `ts-port/tests/unit/` ディレクトリに `.test.ts` という拡張子で配置されています（例: `tests/unit/ScoreManager.test.ts`）。

すべてのユニットテストを一度だけ実行するには：
```bash
npm run test:unit
```

開発中に便利な、ウォッチモードでユニットテストを実行するには：
```bash
npm run test:unit -- --watch
```

テスト結果をインタラクティブに確認できるVitest UIを開くには：
```bash
npm run test:ui
```

## エンドツーエンド（E2E）テストの実行

E2Eテストは `ts-port/tests/` 直下に `.spec.ts` という拡張子で配置されています（例: `tests/smoke.spec.ts`）。`playwright.config.ts` の設定により、テスト実行前にVite開発サーバーが自動的に起動します。

すべてのE2Eテストを実行するには：
```bash
npm run test:e2e
```

最後に実行されたE2EテストのHTMLレポートを表示するには：
```bash
npx playwright show-report
```

## CIとローカルでのテスト

`npm test` コマンドはユニットテストのみを実行します。これは高速なフィードバックサイクルを目的としています。E2Eテストは時間がかかるため、`npm run test:e2e` を使って明示的に実行します。

変更をコミットする前やCI環境では、両方のテストを実行して、アプリケーション全体の健全性を確認することを推奨します。
