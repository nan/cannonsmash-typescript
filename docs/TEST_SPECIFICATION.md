# テスト仕様書

このドキュメントは、プロジェクトに実装されている自動テストの仕様を定義します。

## 1. ユニットテスト

ユニットテストは、個々のモジュール（クラスや関数）が期待通りに動作することを検証します。

### 1.1. ScoreManager (`tests/unit/ScoreManager.test.ts`)

**テスト対象:** `ScoreManager`クラスのスコア計算、状態管理、サーブ権判定ロジック

| テストケースID | テスト内容 | 前提条件 | 手順 | 期待される結果 |
| :--- | :--- | :--- | :--- | :--- |
| **SM-01** | **初期化** | - | 1. `ScoreManager`の新しいインスタンスを作成する。 | 1. `score1`と`score2`が`0`であること。<br>2. `isGameOver`が`false`であること。 |
| **SM-02** | **リセット** | スコア (`score1`, `score2`) とゲームオーバー状態 (`isGameOver`) が任意の値に設定されている。 | 1. `reset()`メソッドを呼び出す。 | 1. `score1`と`score2`が`0`に戻ること。<br>2. `isGameOver`が`false`に戻ること。 |
| **SM-03** | **プレイヤー1へのポイント付与** | ゲームが進行中である。 | 1. プレイヤー1（人間）がポイントを獲得する状況を示す`BallStatus`で`awardPoint()`を呼び出す。 | 1. `score1`が`1`増加すること。<br>2. `score2`は変動しないこと。 |
| **SM-04** | **プレイヤー2へのポイント付与** | ゲームが進行中である。 | 1. プレイヤー2（AI）がポイントを獲得する状況を示す`BallStatus`で`awardPoint()`を呼び出す。 | 1. `score2`が`1`増加すること。<br>2. `score1`は変動しないこと。 |
| **SM-05** | **ゲームオーバー時のポイント付与** | `isGameOver`が`true`である。 | 1. `awardPoint()`を呼び出す。 | 1. `score1`と`score2`が変動しないこと。 |
| **SM-06** | **ゲーム終了条件（通常）** | スコアが10-9（プレイヤー1リード）。 | 1. プレイヤー1がポイントを獲得する。 | 1. `isGameOver`が`true`になること。<br>2. スコアボードの表示が "You Win!" になること。 |
| **SM-07** | **ゲーム終了条件（デュース - 続行）** | スコアが10-10。 | 1. プレイヤー1がポイントを獲得する。 | 1. `isGameOver`が`false`のままであること。 |
| **SM-08** | **ゲーム終了条件（デュース - 終了）** | スコアが11-10（プレイヤー1リード）。 | 1. プレイヤー1がポイントを獲得する。 | 1. `isGameOver`が`true`になること。 |
| **SM-09** | **ゲーム終了後の画面遷移** | ゲームが終了する条件が満たされている。 | 1. `awardPoint()`を呼び出す。<br>2. `setTimeout`で設定された時間が経過する。 | 1. `returnToDemo()`メソッドが呼び出されること。 |
| **SM-10** | **サーブ権判定（11ポイント制）** | ゲームが進行中である。 | 1. 様々なスコア状況で`getService()`を呼び出す。<br>   - 0-0<br>   - 2-0<br>   - 10-10<br>   - 11-10 | 1. 各スコア状況に応じて、正しいプレイヤー (`1`または`-1`) にサーブ権が与えられること。 |

---

## 2. E2E（エンドツーエンド）テスト

E2Eテストは、アプリケーション全体が実際のユーザー環境（ブラウザ）で正しく動作することを検証します。

### 2.1. アプリケーション起動 (`tests/smoke.spec.ts`)

**テスト対象:** アプリケーションの起動と初期表示

| テストケースID | テスト内容 | 前提条件 | 手順 | 期待される結果 |
| :--- | :--- | :--- | :--- | :--- |
| **E2E-01** | **スモークテスト** | 開発サーバーが起動している。 | 1. アプリケーションのルートURL (`/`) にアクセスする。<br>2. ページのタイトルを検証する。<br>3. ブラウザのコンソール出力を監視する。 | 1. ページのタイトルに "CannonSmash" が含まれていること。<br>2. `error`レベルのコンソールログが出力されないこと。 |
